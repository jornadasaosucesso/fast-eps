<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Or√ßamento ‚Äî FAST EPS</title>

<style>
:root{
  --bg:#0b0b0b; --card:#0f0f0f; --accent:#00e5ff; --muted:#bfcbd0;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,Arial;
  background:var(--bg);
  color:#fff;
  padding:14px
}
.wrap{
  max-width:1050px;
  margin:auto;
  display:grid;
  grid-template-columns: 1.2fr 1fr;
  gap:12px
}
h1{
  grid-column:1/-1;
  color:var(--accent);
  margin:0 0 6px 0
}
.card{
  background:var(--card);
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.05)
}
label{font-size:12px;color:var(--muted)}
input,select,button{
  width:100%;
  padding:8px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,.05);
  background:#0b0b0b;
  color:#fff
}
.row{display:flex;gap:8px}
.row>*{flex:1}
.btn{
  background:var(--accent);
  color:#000;
  font-weight:700;
  border:none;
  cursor:pointer
}
.summary{
  background:#071214;
  padding:10px;
  border-radius:8px;
  font-size:14px
}
.muted{color:var(--muted)}
.hidden{display:none}
</style>
</head>

<body>
<div class="wrap">
<h1>Or√ßamento ‚Äî FAST EPS</h1>

<!-- PAINEL ESQUERDO -->
<div class="card">
<label>Cliente</label>
<input id="cliente" placeholder="Nome do cliente">

<div class="row" style="margin-top:6px">
  <div>
    <label>Tipo de Placa</label>
    <select id="produto">
      <option value="">Selecione</option>
      <option value="painel_p10_50g">Placa Interna (50G)</option>
      <option value="painel_p10_65g">Placa Externa (65G)</option>
    </select>
  </div>
  <div>
    <label>Quantidade de Placas</label>
    <input id="quantidade" type="number" min="1" value="1">
  </div>
</div>

<div class="row" style="margin-top:6px">
  <div>
    <label>√Årea total (m¬≤)</label>
    <input id="area" type="number" placeholder="ex: 200">
  </div>
  <div>
    <label>Espessura</label>
    <select disabled>
      <option>10 cm (P10)</option>
    </select>
  </div>
</div>

<div class="muted" style="margin-top:6px">
  Cada placa cobre <b>2,00 m¬≤</b>
</div>

<div class="row" style="margin-top:8px">
  <button class="btn" onclick="calcularOrcamento()">Simular capacidade</button>
</div>

<div class="row" style="margin-top:6px">
  <button class="btn hidden" id="btnCompras" onclick="gerarListaCompras()">
    üõí Gerar lista de compras
  </button>
</div>
</div>

<!-- PAINEL DIREITO -->
<div class="card">
<strong>Resumo Operacional</strong>
<div id="resumo" class="summary" style="margin-top:6px">‚Äî</div>
</div>

</div>

<script>
/* ===== CONSTANTES ===== */
const AREA_POR_PLACA = 2.0;
const STORAGE_KEY = "estoque_fast_eps";

/* ===== ESTOQUE REAL ===== */
function lerEstoqueReal(){
  const dados = localStorage.getItem(STORAGE_KEY);
  if(!dados) return [];
  return JSON.parse(dados);
}

function estoquePorCodigo(codigo){
  const estoque = lerEstoqueReal();
  const item = estoque.find(i => i.codigo === codigo);
  return item ? item.quantidade : 0;
}

/* ===== RECEITAS ===== */
const receitas = {
  painel_p10_50g:{
    nome:'Placa Interna 50G',
    fator_perda:0.07,
    itens:{
      eps:15,
      tela:1.1,
      cimento:48,
      areia:18,
      aditivo:0.02,
      conectores:0.8
    }
  },
  painel_p10_65g:{
    nome:'Placa Externa 65G',
    fator_perda:0.08,
    itens:{
      eps:16.2,
      tela:1.18,
      cimento:54,
      areia:20.52,
      aditivo:0.024,
      conectores:0.9
    }
  }
};

/* ===== VALIDA√á√ÉO ===== */
function validarArea(area, placas){
  const cobre = placas * AREA_POR_PLACA;
  if(area && cobre < area){
    alert(`üö´ ${placas} placas cobrem apenas ${cobre} m¬≤`);
    return false;
  }
  return true;
}

/* ===== CAPACIDADE ===== */
function capacidadePlacas(produto){
  const r = receitas[produto];
  let max = Infinity;
  let gargalo = '';

  for(const k in r.itens){
    const consumo = r.itens[k] * (1 + r.fator_perda);
    const disponivel = estoquePorCodigo(k);
    const placas = Math.floor(disponivel / consumo);

    if(placas < max){
      max = placas;
      gargalo = k;
    }
  }
  return { max, gargalo };
}

/* ===== COMPRAS ===== */
function calcularCompras(produto, faltantes){
  const r = receitas[produto];
  const lista = {};

  for(const k in r.itens){
    const consumo = r.itens[k] * (1 + r.fator_perda);
    lista[k] = consumo * faltantes;
  }
  return lista;
}

/* ===== PRINCIPAL ===== */
function calcularOrcamento(){
  const cliente = clienteEl.value || '‚Äî';
  const produto = produtoEl.value;
  const qtd = Number(quantidadeEl.value);
  const area = Number(areaEl.value);
  const resumo = document.getElementById('resumo');

  if(!produto || !qtd){
    resumo.innerHTML = 'Preencha produto e quantidade.';
    return;
  }

  if(!validarArea(area, qtd)) return;

  const cap = capacidadePlacas(produto);
  let status = 'üü¢ OK para venda';
  let comprasHTML = '';

  if(cap.max < qtd){
    status = 'üî¥ Estoque insuficiente';

    const faltantes = qtd - cap.max;
    const compras = calcularCompras(produto, faltantes);

    comprasHTML = `
      <hr>
      <strong>üì¶ Necessidade de Compra</strong>
      <div class="summary" style="margin-top:6px">
        Para produzir <b>+${faltantes}</b> placas:
        <ul style="margin:6px 0 0 18px">
          ${Object.entries(compras)
            .map(([k,v]) => `<li>${k}: ${v.toFixed(2)}</li>`)
            .join('')}
        </ul>
      </div>
    `;
  }
  else if(cap.max < qtd * 1.2){
    status = 'üü° Aten√ß√£o ao estoque';
  }

  resumo.innerHTML = `
    <div><b>Cliente:</b> ${cliente}</div>
    <div><b>Produto:</b> ${receitas[produto].nome}</div>
    <div><b>√Årea:</b> ${area || '‚Äî'} m¬≤</div>
    <div><b>Placas:</b> ${qtd}</div>
    <hr>
    <div><b>Capacidade produtiva:</b> ${cap.max} placas</div>
    <div><b>Status:</b> ${status}</div>
    <div class="muted">Insumo limitante: ${cap.gargalo}</div>
    ${comprasHTML}
  `;
}

/* ===== ELEMENTOS ===== */
const clienteEl = document.getElementById('cliente');
const produtoEl = document.getElementById('produto');
const quantidadeEl = document.getElementById('quantidade');
const areaEl = document.getElementById('area');
</script>
</body>
</html>


